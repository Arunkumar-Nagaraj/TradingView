def currentJobDetail

pipeline {
    options { buildDiscarder(logRotator(numToKeepStr: '10')) }
    agent {
        kubernetes {
            workspaceVolume hostPathWorkspaceVolume("/*path of an jenkins workspace*/")
            yaml '''
                apiVersion: v1
                kind: Pod
                metadata:
                    labels:
                        label: jenkins-node
                spec:
                    nodeSelector:
                        node-role.kubernetes.io/worker: true
                    containers:
                        - name: node
                          image: registryname
                          command:
                            - cat
                          tty: true
            '''
        }
    }
    parameters {
        string(name: 'env', defaultValue: 'DEV', description: 'Environment to run')
//        pass parameters whatever required like env ,pack ,browser etc
    }
    environment {
        NODE_TLS_REJECT_UNAUTHORIZED='0'
        /** provide all the required env values like above examples */
    }
    stages{
        stage('Runner Configuration') {
            steps{
                script{
                    currentJobDetail = "${currentBuild.projectName}";
                }
            }
        }
        stage ('Clear Workspace') {
            steps{
                step([$class: 'WsCleanup', notFailBuild: true])
            }
        }
        stage ('Pull Main Code') {
            steps {
                script{
                    /** Before that it requires service account of jenkins needs to be added to repo so that it can be cloned*/
                    git(url: '/** to provide clone ssh key */',
                            credentialsId: 'gitssh',
                            branch: params.branch)
                }
            }
        }
        stage('Import Maven Dependencies'){
            steps {
                container('node') {
                    script{
                        /** mvn clean install*/
                    }
                }
            }
        }


        stage("Execute Tests") {
            steps {
                container('node'){
                    script{
                        echo 'Running from Jenkins file'
                        sh(script: 'mvn compile', label: 'maven')
                    /** mvn test command for execution
                     * Need to configure testng.xml file so that test cases be executed parallel
                     * */
                    }
                }
            }
        }
    }
    post {
          always {
                  script {
                      mail from: 'jenkins-jobs@directlinegroup.co.uk',
                      to: 'Recipient mail ids',
                      bcc: 'ecipient mail ids',
                      subject: '[Jenkins Report]',
                      body: "\n BUILD STATUS : ${currentBuild.currentResult} \n JOB NAME: ${env.JOB_NAME} \n BUILD_NO: ${env.BUILD_NUMBER} \n More Info at : ${env.BUILD_URL} "
                  }

              }
    }

}